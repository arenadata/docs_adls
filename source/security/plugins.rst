Включение плагинов Ranger
=========================

Плагины **Ranger** могут быть включены для нескольких сервисов **ADH**. По соображениям производительности рекомендуется хранить аудиты в **Solr**, а не в базе данных.

Доступны следующие плагины **Ranger**: `HDFS`_, **Hive**, **HBase**, **YARN**, **Sqoop**.

.. important:: Перед включением плагинов необходимо сделать import в том кластере, который будет интегрирован с ADPS

.. _security_import:

.. figure:: ../imgs/security_import.*
   :align: center


HDFS
`````

Для включения плагина **Ranger HDFS** необходимо выполнить следующие действия:

На странице сервиса HDFS кластера ADH в разделе "Run action", выбрать Enable Ranger Plugin. После чего запустится процесс активации плагина и создание дефолтной политике на стороне Ranger.


HDFS Policy
------------

Ranger для авторизации в Hadoop
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

После проверки подлинности пользователя необходимо определить его права доступа. Права доступа пользователя к ресурсам определяет авторизация. Например, пользователю может быть разрешено создание политики и просмотр отчетов, но не разрешено редактирование пользователей и групп. **Ranger** можно использовать для настройки и управления доступом к сервисам **Hadoop**.

**Ranger** позволяет создавать сервисы для определенных ресурсов **Hadoop** (**HDFS**, **HBase**, **Hive** и др.) и добавлять права доступа к этим сервисам. Можно также создавать сервисы на основе тегов и добавлять политики доступа к ним. Использование политик на основе тегов позволяет управлять доступом к ресурсам нескольких компонентов **Hadoop** без создания отдельных сервисов и политик в каждом компоненте. Можно также использовать **Ranger TagSync** для синхронизации хранилища тегов **Ranger** с внешним сервисом метаданных, таким как **Apache Atlas**.


Создание HDFS Policy
^^^^^^^^^^^^^^^^^^^^^

Благодаря конфигурации **Apache Ranger** позволяет проверять для запроса пользователя как политики **Ranger**, так и разрешения **HDFS**. Когда **NameNode** получает пользовательский запрос, плагин **Ranger** проверяет политики, установленные через **Ranger Service Manager**, и если их нет, проверяет разрешения, установленные в **HDFS**.

Рекомендуется создавать разрешения в **Ranger Service Manager** и иметь ограниченные разрешения на уровне **HDFS**.

Добавление новой политики к существующему сервису **HDFS** осуществляется по следующему алгоритму:

1. На странице "Service Manager" выбрать существующий сервис в разделе HDFS (:numref:`Рис.%s.<security_authorizationHadoop_PolicyHDFS_Existing-service>`).

.. _security_authorizationHadoop_PolicyHDFS_Existing-service:

.. figure:: ../imgs/security_authorizationHadoop_PolicyHDFS_Existing-service.*
   :align: center

   Выбор сервиса HDFS

При этом открывается страница "List of Policies", на которой необходимо нажать кнопку "Add New Policy" (:numref:`Рис.%s.<security_authorizationHadoop_PolicyHDFS_List-Policies>`).

.. _security_authorizationHadoop_PolicyHDFS_List-Policies:

.. figure:: ../imgs/security_authorizationHadoop_PolicyHDFS_List-Policies.*
   :align: center

   List of Policies

2. Открывается страница "Create Policy" (:numref:`Рис.%s.<security_authorizationHadoop_PolicyHDFS_Create-Policy>`).

.. _security_authorizationHadoop_PolicyHDFS_Create-Policy:

.. figure:: ../imgs/security_authorizationHadoop_PolicyHDFS_Create-Policy.*
   :align: center

   Create Policy

На странице необходимо заполнить поля. Раздел "Policy Details":

+ *Policy Name* -- ввести уникальное имя для данной политики (имя не может быть продублировано нигде в системе);
+ *Resource Path* -- определить путь к ресурсу для папки/файла политики. Во избежание необходимости указывать полный путь или включать политику для всех вложенных папок или файлов, можно заполнить это поле с помощью подстановочных знаков (например, /home*) либо указать, что политика должна быть рекурсивной;

  + Подстановочные знаки могут быть включены в путь ресурса, имя базы данных, таблицы или столбца: "*" -- указывает ноль или более символов; "?" -- указывает один символ;

+ *Description* -- (опционально) указать цель политики;
+ *Audit Logging* -- указать, выполняется ли аудит данной политики (снять флажок, чтобы отключить аудит).

Раздел "Allow Conditions":

+ *Select Group* -- указать группу, к которой применяется данная политика. Чтобы назначить группу в качестве администратора для выбранного ресурса, выбрать *Admin permissions* (администраторы могут создавать дочерние политики на основе существующих). Группа *public* содержит всех пользователей, поэтому предоставление доступа к ней предоставляет доступ ко всем пользователям;
+ *Select User* -- указать конкретного пользователя, к которому применяется данная политика (за пределами уже указанной группы), или назначить определенного пользователя администратором данной политики (администраторы могут создавать дочерние политики на основе существующих);
+ *Permissions* -- добавить или изменить права: *Read* (чтение), *Write* (запись), *Create* (создание), *Admin* (Администратор), *Select/Deselect All* (выбрать/отменить все);
+ *Delegate Admin* -- когда политика назначается пользователю или группе пользователей, данные пользователи становятся делегированными администраторами. Делегированный администратор может обновлять, удалять политики. Он также может создавать дочерние политики на основе исходной (базовой);

3. Для добавления дополнительных условий можно использовать символ плюс "+". Условия оцениваются в порядке, указанном в списке -- сначала применяется условие в верхней части списка, затем второе, третье и так далее;

4. Нажать кнопку *Add* для сохранения новой политики.
